name: ðŸšª Root Naming Policy Gate

on:
  pull_request:
    types: [opened, edited, synchronize, reopened, ready_for_review]
    paths:
      - root.*
      - init.d/**
      - bin/**
      - sbin/**
      - etc/**
      - lib/**
      - var/**
      - usr/**
      - controlplane/baseline/**
      - workspace/config/**

permissions:
  contents: read
  pull-requests: write

jobs:
  validate_root_naming:
    name: ðŸ” é©—è­‰ root/ å‘½åè¦ç¯„
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ æª¢å‡ºä»£ç¢¼
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5

      - name: ðŸ” æª¢æŸ¥ root å‘½å
        run: |
          set -euo pipefail
          violations=0
          targets=(root.* init.d bin sbin etc lib var usr controlplane/baseline workspace/config)
          for target in "${targets[@]}"; do
            if compgen -G "$target" > /dev/null; then
              if [ -d "$target" ]; then
                while IFS= read -r file; do
                  basename=$(basename "$file")
                  case "$basename" in
                    *[A-Z]*)
                      echo "âŒ æ–‡ä»¶å«æœ‰å¤§å¯«å­—æ¯: $file" >> "$GITHUB_STEP_SUMMARY"
                      violations=$((violations+1))
                      ;;
                    *\ * )
                      echo "âŒ æ–‡ä»¶å«æœ‰ç©ºç™½: $file" >> "$GITHUB_STEP_SUMMARY"
                      violations=$((violations+1))
                      ;;
                  esac
                done < <(find "$target" -maxdepth 3 -type f)
              else
                for file in $target; do
                  [ -e "$file" ] || continue
                  basename=$(basename "$file")
                  case "$basename" in
                    *[A-Z]*)
                      echo "âŒ æ–‡ä»¶å«æœ‰å¤§å¯«å­—æ¯: $file" >> "$GITHUB_STEP_SUMMARY"
                      violations=$((violations+1))
                      ;;
                    *\ * )
                      echo "âŒ æ–‡ä»¶å«æœ‰ç©ºç™½: $file" >> "$GITHUB_STEP_SUMMARY"
                      violations=$((violations+1))
                      ;;
                  esac
                done
              fi
            fi
          done

          if [ $violations -eq 0 ]; then
            echo "âœ… æ‰€æœ‰æª”æ¡ˆç¬¦åˆå‘½åè¦ç¯„" >> "$GITHUB_STEP_SUMMARY"
          else
            echo "ç¸½è¨ˆ $violations é …å‘½åé•è¦" >> "$GITHUB_STEP_SUMMARY"
            exit 1
          fi
